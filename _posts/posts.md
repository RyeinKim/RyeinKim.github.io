---
layout: allposts
title: Posts
---

인증인가 부분에서 오류가 발생해서 골머리를 썩힘

1. 프론트엔드에서 JSON데이터 email, password 를 포함해 로그인 API를 호출하였는데 백엔드에 정상적으로 도착하지 않고
그냥 공백이 오는 문제
계속 찾아보니 JSON데이터 에 관련된 문제가 문제가 아니고 세션유지가 안되는 상황이었음. (브라우저 개발자 도구의 네트워크 탭을 활용해 확인)

1차 해결 - 세션안에 user_id 정보를 가져와서 로그인 여부를 라우트에서 검사하고 true 일 경우 진행하는 방식으로 로그인 검사를 했었는데,
그냥 session 자체로 검사하는 방식으로 변경하니 해결

여기서 의문 -> '세션'만 존재하면 되는게 맞는가
...게시글에 접근하는 권한이라던지.. 이러한 권한에서는 문제가 생길 수 있다고 판단, user_id 를 존재 여부로 판단하는 것이 필연적이라 생각이 듦

2. 다시 user_id 의 존재여부 판단 조건으로 진행하던 중 세션유지 문제가 해결된 것이 아닌 인증절차 자체가 작동하지 않던 것이라는 것을 확인.
네트워크 탭을 살펴보니 요청쿠키는 connect.sid, sessionID 를 요청하는데 응답 쿠키에는 connect.sid 만 존재하는 것이
의문이 들어 계속 삽질 시작.

해결 과정 중 - connect.sid 관련해서 계속 타고타고 로깅해보니 connect.sid 에 sessionID 가 포함되어 있다는 것을 확인함.
(관련 내용을 찾아보니 
" connect.sid 쿠키에는 세션 식별자가 포함되어 있으며, 클라이언트 측에서는 일반적으로 sessionID라는 이름의 쿠키를 생성하여 해당 세션 식별자를 저장"
이라고 한다)
<br>

localhost 에서 개발을 하고 있어서 Let's Encrpty 도 쓸 수 없어 HTTP로 개발을 하고 있었고
세션 설정을 해둔 것 중에 sameSite 를 'none' 으로 설정해둔 것을 확인.
그래서 sameSite 에 대해서 다시금 찾아보니

1. 'none' - 보안상의 이유로 HTTPS 연결에서만 사용
2. 'Lax' - 기본적인 보안만 제공, 일부 예외적 상황에서도 쿠키 전송이 가능하도록 허용
3. 'Strict' - 쿠키가 요청의 출처와 정확하게 일치하는 경우만 전송이 가능

라고 한다.. 그래서 'Lax'로 변경하니 인증 완료.

이렇게 인증 관련 문제를 해결하니 줄줄이 에러가 또 나왔다.

이번엔 DB에 있는 유저 데이터를 목록화 하는 API에서 문제가 발생했는데,
POSTMAN을 사용했을 때에는 정상적으로 유저목록이 출력되지만 프론트엔드의 콘솔에서는 undefined가 출력되는 것.
그래서 로깅을 시작해보니 백엔드로부터 받아온 data 가 형식이 조금 바뀌어있었다.
이 이유에 대해서 찾아보니 백엔드 서버와 프론트엔드 서버를 연동하는 과정에 있어서 필연적인 코드 수정이 있기 때문에
데이터의 구조나 내용이 변경될 가능성이 있다는 것이다. 그래서 data를 바로 로깅해보았고 기존에는 message 객체에
유저 데이터가 담겨있었다면 현재는 아예 data 객체에 직통으로 유저 데이터 정보 객체가 담겨있었다.
그래서 map 함수를 활용해 뽑아내는 식으로 변경하였다.